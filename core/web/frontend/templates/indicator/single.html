{% extends "base.html" %}
{% import "macros.html" as macros %}

{% block main %}
{% set indicator = obj %}
<div class="row">
<!-- start first column -->
  <div class="col-md-9">

    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
                {{indicator.name}} <span class="small">{{indicator.type}}</span>
                <a href="{{url_for('frontend.graph_node', id=indicator.id, klass='entity')}}" class="btn btn-default btn-xs pull-right"><i class="flaticon-network38"></i> New Investigation</a>
                <a href="{{url_for('frontend.IndicatorsView:edit', id=indicator.id)}}" class="btn btn-default btn-xs pull-right"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit</a>
            </h3>
          </div>
          <div class="panel-body">
            {% if indicator.description %}
            {{indicator.description|markdown}}
            {%else%}
            <em>No description provided</em>
            {%endif%}
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
                Pattern
            </h3>
          </div>
          <div class="panel-body">
            <code>
              {{ indicator.pattern }}
            </code>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        {% set n = indicator.neighbors() %}

        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active"><a href="#ttp" aria-controls="ttp" role="tab" data-toggle="tab">TTP</a></li>
          <li role="presentation"><a href="#malware" aria-controls="malware" role="tab" data-toggle="tab">Malware</a></li>
          <li role="presentation"><a href="#actors" aria-controls="actors" role="tab" data-toggle="tab">Actors</a></li>
          <li role="presentation"><a href="#observables" aria-controls="observables" role="tab" data-toggle="tab">Observables</a></li>
        </ul>

        <div class="tab-content">

            <div role="tabpanel" class="tab-pane active" id="ttp"> <!-- TTP tab -->
              <div class="row">
                <div class="col-md-12">
                  <table class="table table-condensed">
                    <tr><th>Name</th><th>Description</th><th>Killchain</th></tr>
                    {% for type, entry in n.items() if "TTP" in type %}
                      {% for link, node in entry %}
                      <tr>
                        <td><a href="{{ url_for("frontend.EntitiesView:get", id=node.id)}}">{{node.name}}</a></td>
                        <td>{{ node.description }}</td>
                        <td>{{ node.killchain }}</td>
                      </tr>
                      {% endfor %}
                    {%endfor%}
                  </table>
                </div>
              </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="malware"> <!-- malware tab -->
              <div class="row">
                <div class="col-md-12">
                  <table class="table table-condensed">
                    <tr><th>Name</th><th>Link</th><th>Family</th><th>Aliases</th></tr>
                    {% for type, entry in n.items() if "Malware" in type %}
                      {% for link, node in entry %}
                      <tr>
                        <td><a href="{{ url_for("frontend.EntitiesView:get", id=node.id)}}">{{node.name}}</a></td>
                        <td>{{link.description}}</td>
                        <td>{{ node.family.name }}</td>
                        <td>{{ macros.display_tags(node.aliases)}}</td>
                        <td>{{node.context|join(', ', attribute='source')}}</td>
                      </tr>
                      {% endfor %}
                    {%endfor%}
                  </table>

                </div>
              </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="actors"> <!-- actors tab -->
              <div class="row">
                <div class="col-md-12">
                  <table class="table table-condensed">
                    <tr><th>Name</th><th>Link</th><th>Pattern</th></tr>
                    {% for type, entry in n.items() if "Actor" in type %}
                      {% for link, node in entry %}
                      <tr>
                        <td><a href="{{ url_for("frontend.EntitiesView:get", id=node.id)}}">{{node.name}}</a></td>
                        <td>{{link.description}}</td>
                        <td>{{ node.pattern }}</td>
                      </tr>
                      {% endfor %}
                    {%endfor%}
                  </table>
                </div>
              </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="observables"> <!-- Observables tab -->
              <div class="row">
                <div class="col-md-12">
                  <table class="table table-condensed">
                    <tr><th>Observable</th><th>Link</th><th>Type</th><th>Tags</th></tr>
                    {% for type, entry in n.items() if "Observable" in type %}
                      {% for link, node in entry %}
                      <tr>
                        <td><a href="{{ url_for("frontend.ObservablesView:get", id=node.id)}}">{{node.value}}</a></td>
                        <td>{{link.description}}</td>
                        <td>{{ node.type }}</td>
                        <td>{{ macros.display_tags(node.tags) }}</td>
                      </tr>
                      {% endfor %}
                    {%endfor%}
                  </table>
                </div>
              </div>
            </div>

        </div>

      </div>
    </div>


  </div>
<!-- end first column -->

  <div class="col-md-3">

    <div class="panel panel-primary yeti-panel">
      <div class="panel-heading">
        <h3 class="panel-title">Info</h3>
      </div>
      <div class="panel-body">
        <table class="table table-condensed main-table">
          {% for key, value in indicator.info().items() %}
          {% if key not in ["context", "value", "last_analyses", "pattern", "description"] %}
            <tr><th>{{key}}</th><td>{{macros.display_yeti(value, key)}}</td></tr>
          {% endif %}
          {% endfor %}
        </table>
      </div>
    </div>

  </div>

</div>

{% endblock %}
